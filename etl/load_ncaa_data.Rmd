---
title: "Title Goes Here"
author: "Names Go Here" 
output:
  html_document:
    theme: cerulean
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 3
    df_print: paged
  md_document:
    variant: markdown_github
    toc: true
    toc_depth: 3
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction
This data notebook contains the analysis that generated facts in the story ["Title"]() from the series ["Series"](). For each sentence in the story generated by original data analysis, we have provided the corresponding code and results.

## Load Libraries, Settings and Global Functions
```{r warning=FALSE,error=FALSE,message=FALSE}
# For general data science
library(tidyverse)

# For data cleaning
library(janitor)

# For loading Excel files
library(readxl)

# For working with datetime
library(lubridate)

# For U.S. Census Bureau data
library(tigris)




```

## Load and Clean Data
```{r warning=FALSE,error=FALSE,message=FALSE}

# NCAA
ncaa_champs <- read_csv("../data/handmade/ncaa-champs.csv") %>% 
  separate(champion_record, into = c('champion', 'record'), sep = ' \\(') %>%
  mutate(record = str_remove(record, "\\)"))


# Her Hoop Stats
# Load Her Hoop Stats data on programs with an HHS rating greater than or equal to 40. The data includes season-long stats for each program in the year that the rating of 40 or above was given.

hhs_40 <- read_csv("../data/herhoopstats/hhs_rating_40_above.csv") %>% 
  clean_names()


# Load Her Hoop Stats data on NCAA champions from the past 13 years. The data includes season-long stats for each program in each year from 2009-10 to 2021-22.
hhs_champs <- read_csv("../data/herhoopstats/hhs_champs_all_ratings.csv") %>% 
  clean_names()


# Load NCAA tournament data from 2010-2021.
tournament_2010_2021 <- read_tsv("../data/ncaa_tournament_games_20220316.tsv")

# Load season records for 2021-22
season_records_2021_22 <- read_csv("../data/herhoopstats/season_record_2021_22.csv") %>% 
  clean_names()
```

## Analysis & Graphics
### Bar chart: NCAA Championships by Program
### Chattter: "

### Graphic Table
### Chattter: 15 schools have won NCAA titles since the first women's basketball championship in 1982. Four programs have added to their title count in the last five championships, but UConn and Tennessee still lead the pack.
```{r}
# Get title count
title_count <- ncaa_champs %>% 
  group_by(champion) %>% 
  count() %>% 
  filter(champion !="Canceled due to Covid-19") %>% 
  arrange(desc(n))

# Define a list of the 15 NCAA championship programs
champions = c("Connecticut", "UConn", "Tennessee", "Baylor", "Stanford", "Louisiana Tech", "Notre Dame", "South Carolina", "Southern California", "Maryland", "North Carolina", "Old Dominion", "Purdue", "Texas", "Texas A&M", "Texas Tech")

# Get years
years <- ncaa_champs %>% 
  filter(champion %in% champions) %>% 
  arrange(champion, year)

# Get Final Four appearances since 2010
final_four_1 <- tournament_2010_2021 %>% 
  filter(round == "F4") %>% 
  group_by(team_1_name) %>% 
  count()

final_four_2 <- tournament_2010_2021 %>% 
  filter(round == "F4") %>% 
  group_by(team_2_name) %>% 
  count()

team  <- c("South Carolina", "Louisville", "Stanford", "UConn")
add_one_for_2022 <- c(1, 1, 1, 1)
ff_2022 <- data.frame(team, add_one_for_2022) 

final_four_count <- final_four_1 %>% 
  right_join(final_four_2, by = c("team_1_name" = "team_2_name")) %>%
  left_join(ff_2022, by = c("team_1_name" = "team"))%>% 
  replace(is.na(.), 0) %>% 
  mutate(n = n.x+n.y+add_one_for_2022) %>% 
  select(team_1_name, n) %>% 
  rename(team = team_1_name) %>% 
  arrange(desc(n)) %>% 
  filter(team %in% champions)


# Get 2021-22 season records for championship programs
champs_season_records <- season_records_2021_22 %>% 
  filter(team %in% champions)

```



### Line chart: HHS Ratings of NCAA Champions
### Chattter: ?
```{r}
hhs_line <- hhs_champs %>% 
  filter(team == "Stanford") %>% 
  arrange(season)

print(hhs_line$def_rtg)

```

### Connected dot plot: Min/Max HHS Ratings of NCAA Champions
### Chattter: ?
```{r}
hhs_min_max_champs <- hhs_champs %>% 
  group_by(team) %>% 
  summarise(
    min_hhs_rtg = min(hhs_rtg),
    max_hhs_rtg = max(hhs_rtg)
  ) %>%
  mutate(diff = max_hhs_rtg - min_hhs_rtg) %>% 
  arrange(max_hhs_rtg)

print(hhs_min_max_champs)
```




# Export
```{r}
write_csv(title_count, "../data/processed/etl_title_count.csv")
write_csv(season_record_22, "../data/processed/etl_season_record_22.csv")
write_csv(hhs_min_max_champs, "../data/processed/etl_hhs_min_max_champs.csv")
write_csv(final_four_count, "../data/processed/etl_final_four_count.csv")
```

-30-

